import{_ as n,p as s,q as a,a1 as t}from"./framework-96b046e1.js";const e={},p=t(`<h1 id="vueå“åº”å¼åŸç†-object-defineproperty-å…¨è¿‡ç¨‹è§£æ" tabindex="-1"><a class="header-anchor" href="#vueå“åº”å¼åŸç†-object-defineproperty-å…¨è¿‡ç¨‹è§£æ" aria-hidden="true">#</a> Vueå“åº”å¼åŸç†(Object.defineProperty)å…¨è¿‡ç¨‹è§£æ</h1><h3 id="vue-å¦‚ä½•åŠ¨æ€çš„æ›´æ–°" tabindex="-1"><a class="header-anchor" href="#vue-å¦‚ä½•åŠ¨æ€çš„æ›´æ–°" aria-hidden="true">#</a> Vue å¦‚ä½•åŠ¨æ€çš„æ›´æ–°</h3><aside> ğŸ’¡ Vue çš„å“åº”å¼åŸç†æ˜¯é€šè¿‡ Object.defineProperty å®ç°çš„ã€‚è¢« Object.defineProperty ç»‘å®šè¿‡çš„å¯¹è±¡ï¼Œä¼šå˜æˆã€Œå“åº”å¼ã€åŒ–ã€‚ä¹Ÿå°±æ˜¯æ”¹å˜è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ä¼šè§¦å‘ get å’Œ set äº‹ä»¶ã€‚è¿›è€Œè§¦å‘ä¸€äº›è§†å›¾æ›´æ–°ã€‚å…¶ä¸­æœ€é‡è¦çš„å‡ ä¸ªç‚¹åŒ…æ‹¬ Observerï¼Œ defineReactiveï¼Œ Depï¼Œ Watcher </aside><h3 id="observerã€Œå“åº”å¼ã€" tabindex="-1"><a class="header-anchor" href="#observerã€Œå“åº”å¼ã€" aria-hidden="true">#</a> Observerã€Œå“åº”å¼ã€</h3><p>å¾ªç¯ä¿®æ”¹ä¸ºæ¯ä¸ªå±æ€§æ·»åŠ  get set</p><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code><span class="token keyword">const</span> <span class="token function-variable function">Observer</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// å¾ªç¯ä¿®æ”¹ä¸ºæ¯ä¸ªå±æ€§æ·»åŠ get setfor (let key in data) {</span>
    <span class="token function">defineReactive</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Object.defineProperty: å®ç°ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œå¹¶ä¸”å°†å¯¹è±¡çš„æ”¹å˜æ¨é€åˆ°è°ƒåº¦ä¸­å¿ƒ Dep ä¸­</p><p>ä¸¾ä¸ªä¾‹å­ ğŸŒ°ï¼š</p><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;æˆ‘è¢«è¯»äº†ï¼Œæˆ‘è¦ä¸è¦åšç‚¹ä»€ä¹ˆå¥½?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">===</span> newVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      val <span class="token operator">=</span> newVal<span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;æ•°æ®è¢«æ”¹å˜äº†ï¼Œæˆ‘è¦æŠŠæ–°çš„å€¼æ¸²æŸ“åˆ°é¡µé¢ä¸Šå»!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// å¯¹dataä¸Šçš„textå±æ€§è¿›è¡Œç»‘å®š</span>
<span class="token function">defineReactive</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ§åˆ¶å°è¾“å‡º &lt;æˆ‘è¢«è¯»äº†ï¼Œæˆ‘è¦ä¸è¦åšç‚¹ä»€ä¹ˆå¥½?&gt;</span>
data<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">&quot;hello Vue&quot;</span><span class="token punctuation">;</span><span class="token comment">// æ§åˆ¶å°è¾“å‡º &lt;hello Vue &amp;&amp; æ•°æ®è¢«æ”¹å˜äº†ï¼Œæˆ‘è¦æŠŠæ–°çš„å€¼æ¸²æŸ“åˆ°é¡µé¢ä¸Šå»!&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="dep-ã€Œä¾èµ–ç®¡ç†ã€" tabindex="-1"><a class="header-anchor" href="#dep-ã€Œä¾èµ–ç®¡ç†ã€" aria-hidden="true">#</a> Dep ã€Œä¾èµ–ç®¡ç†ã€</h3><p>Dep å¯¹è±¡ç”¨äºä¾èµ–æ”¶é›†ï¼Œå®ƒå®ç°äº†ä¸€ä¸ªå‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œå®Œæˆäº†æ•°æ® Data å’Œæ¸²æŸ“è§†å›¾ Watcher çš„è®¢é˜…ï¼Œ</p><p>Depå¯¹è±¡ä¸­çš„ subs æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå­˜æ”¾æœé›†åˆ°çš„ æ‰€æœ‰ä½¿ç”¨åˆ°è¿™ä¸ª data çš„ Watcher å¯¹è±¡ å¯¹è±¡é›†åˆ</p><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span>
  <span class="token comment">// æ ¹æ® ts ç±»å‹æç¤ºï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡º Dep.target æ˜¯ä¸€ä¸ª Watcher ç±»å‹ã€‚</span>
  <span class="token keyword">static</span> <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token operator">?</span>Watcher<span class="token punctuation">;</span>
  <span class="token comment">// subs å­˜æ”¾æœé›†åˆ°çš„ Watcher å¯¹è±¡é›†åˆ</span>
  <span class="token literal-property property">subs</span><span class="token operator">:</span> Array<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Watcher</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">;
  constructor() </span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token plain-text">
  addSub(sub: Watcher) </span><span class="token punctuation">{</span>
    <span class="token comment">// æœé›†æ‰€æœ‰ä½¿ç”¨åˆ°è¿™ä¸ª data çš„ Watcher å¯¹è±¡ã€‚</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token plain-text">
  depend() </span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// æœé›†ä¾èµ–ï¼Œæœ€ç»ˆä¼šè°ƒç”¨ä¸Šé¢çš„ addSub æ–¹æ³•</span>
      Dep<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">addDep</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token plain-text">
  notify() </span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> subs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> subs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// è°ƒç”¨å¯¹åº”çš„ Watcherï¼Œæ›´æ–°è§†å›¾</span>
      subs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token plain-text">
}
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ defineReactive æ–¹æ³•å°† data ä¸­çš„æ•°æ®è¿›è¡Œå“åº”å¼åï¼Œè™½ç„¶å¯ä»¥ç›‘å¬åˆ°æ•°æ®çš„å˜åŒ–äº†ï¼Œä½†æ˜¯æ€ä¹ˆå¤„ç†é€šçŸ¥è§†å›¾å°±æ›´æ–°å‘¢ï¼Ÿ</p><p>Dep å°±æ˜¯æ”¶é›†ã€ç©¶ç«Ÿè¦é€šçŸ¥åˆ°å“ªé‡Œçš„ã€‘ã€‚</p><p>æ¯”å¦‚ä¸‹é¢çš„ä»£ç æ¡ˆä¾‹ï¼Œè™½ç„¶ data ä¸­æœ‰ text å’Œ message å±æ€§ï¼Œä½†æ˜¯åªæœ‰ message è¢«æ¸²æŸ“åˆ°é¡µé¢ä¸Šï¼Œè‡³äº text æ— è®ºæ€ä¹ˆå˜åŒ–éƒ½å½±å“ä¸åˆ°è§†å›¾çš„å±•ç¤ºï¼Œå› æ­¤ä»…ä»…å¯¹ message è¿›è¡Œæ”¶é›†å³å¯ï¼Œå¯ä»¥é¿å…ä¸€äº›æ— ç”¨çš„å·¥ä½œã€‚</p><p>é‚£è¿™ä¸ªæ—¶å€™ message çš„ Dep å°±æ”¶é›†åˆ°äº†ä¸€ä¸ªä¾èµ–ï¼Œè¿™ä¸ªä¾èµ–å°±æ˜¯ç”¨æ¥ç®¡ç† data ä¸­ message å˜åŒ–çš„ã€‚</p><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token punctuation">{</span>message<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&#39;hello world&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;hello vue&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä½¿ç”¨ watch å±æ€§æ—¶ï¼Œä¹Ÿå°±æ˜¯å¼€å‘è€…è‡ªå®šä¹‰çš„ç›‘å¬æŸä¸ª data ä¸­å±æ€§çš„å˜åŒ–ã€‚</p><p>æ¯”å¦‚ç›‘å¬ message çš„å˜åŒ–ï¼Œmessage å˜åŒ–æ—¶æˆ‘ä»¬å°±è¦é€šçŸ¥åˆ° watch è¿™ä¸ªé’©å­ï¼Œè®©å®ƒå»æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚</p><p>è¿™ä¸ªæ—¶å€™ message çš„ Dep å°±æ”¶é›†åˆ°äº†ä¸¤ä¸ªä¾èµ–ï¼Œç¬¬äºŒä¸ªä¾èµ–å°±æ˜¯ç”¨æ¥ç®¡ç† watch ä¸­ message å˜åŒ–çš„ã€‚</p><p>å½“å¼€å‘è€…è‡ªå®šä¹‰ computed è®¡ç®—å±æ€§æ—¶ï¼Œå¦‚ä¸‹ messageT å±æ€§ï¼Œæ˜¯ä¾èµ– message çš„å˜åŒ–çš„ã€‚</p><p>å› æ­¤ message å˜åŒ–æ—¶æˆ‘ä»¬ä¹Ÿè¦é€šçŸ¥åˆ° computedï¼Œè®©å®ƒå»æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚</p><p>è¿™ä¸ªæ—¶å€™ message çš„ Dep å°±æ”¶é›†åˆ°äº†ä¸‰ä¸ªä¾èµ–ï¼Œè¿™ä¸ªä¾èµ–å°±æ˜¯ç”¨æ¥ç®¡ç† computed ä¸­ message å˜åŒ–çš„ã€‚</p><p><strong>ä¸€ä¸ªå±æ€§å¯èƒ½æœ‰å¤šä¸ªä¾èµ–ï¼Œæ¯ä¸ªå“åº”å¼æ•°æ®éƒ½æœ‰ä¸€ä¸ª Dep æ¥ç®¡ç†å®ƒçš„ä¾èµ–</strong></p><h3 id="å¦‚ä½•æ”¶é›†ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•æ”¶é›†ä¾èµ–" aria-hidden="true">#</a> å¦‚ä½•æ”¶é›†ä¾èµ–</h3><p>å¦‚ä½•çŸ¥é“ data ä¸­çš„æŸä¸ªå±æ€§è¢«ä½¿ç”¨äº†ï¼Œç­”æ¡ˆå°±æ˜¯ Object.definePropertyï¼Œå› ä¸ºè¯»å–æŸä¸ªå±æ€§å°±ä¼šè§¦å‘ get æ–¹æ³•ã€‚å¯ä»¥å°†ä»£ç è¿›è¡Œå¦‚ä¸‹æ”¹é€ </p><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> Dep<span class="token punctuation">;</span><span class="token comment">// ä¾èµ–Object.defineProperty(obj, key, {</span>
    <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;æˆ‘è¢«è¯»äº†ï¼Œæˆ‘è¦ä¸è¦åšç‚¹ä»€ä¹ˆå¥½?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// è¢«è¯»å–äº†ï¼Œå°†è¿™ä¸ªä¾èµ–æ”¶é›†èµ·æ¥</span>
      Dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æœ¬æ¬¡æ–°å¢return val;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">===</span> newVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      val <span class="token operator">=</span> newVal<span class="token punctuation">;</span>
<span class="token comment">// è¢«æ”¹å˜äº†ï¼Œé€šçŸ¥ä¾èµ–å»æ›´æ–°</span>
      Dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æœ¬æ¬¡æ–°å¢console.log(&quot;æ•°æ®è¢«æ”¹å˜äº†ï¼Œæˆ‘è¦æŠŠæ–°çš„å€¼æ¸²æŸ“åˆ°é¡µé¢ä¸Šå»!&quot;);</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä»€ä¹ˆæ˜¯ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯ä¾èµ–" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯ä¾èµ–</h3><p>é‚£æ‰€è°“çš„ä¾èµ–ç©¶ç«Ÿæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸Šé¢çš„å›¾ä¸­å·²ç»æš´éœ²äº†ç­”æ¡ˆï¼Œå°±æ˜¯ <strong>Watcher</strong>ã€‚</p><h3 id="watcher-ã€Œä¸­ä»‹ã€" tabindex="-1"><a class="header-anchor" href="#watcher-ã€Œä¸­ä»‹ã€" aria-hidden="true">#</a> Watcher ã€Œä¸­ä»‹ã€</h3><p>Watcher å°±æ˜¯ç±»ä¼¼ä¸­ä»‹çš„è§’è‰²ã€‚</p><p>æ¯”å¦‚ message å°±æœ‰ä¸‰ä¸ªä¸­ä»‹ï¼Œå½“ message å˜åŒ–ï¼Œå°±é€šçŸ¥è¿™ä¸‰ä¸ªä¸­ä»‹ï¼Œä»–ä»¬å°±å»æ‰§è¡Œå„è‡ªéœ€è¦åšçš„å˜åŒ–ã€‚</p><p>Watcher èƒ½å¤Ÿæ§åˆ¶è‡ªå·±å±äºå“ªä¸ªï¼Œæ˜¯ data ä¸­çš„å±æ€§çš„è¿˜æ˜¯ watchï¼Œæˆ–è€…æ˜¯ computedï¼ŒWatcher è‡ªå·±æœ‰ç»Ÿä¸€çš„æ›´æ–°å…¥å£ï¼Œåªè¦ä½ é€šçŸ¥å®ƒï¼Œå°±ä¼šæ‰§è¡Œå¯¹åº”çš„æ›´æ–°æ–¹æ³•ã€‚</p><p>å› æ­¤æˆ‘ä»¬å¯ä»¥æ¨æµ‹å‡ºï¼ŒWatcher å¿…é¡»è¦æœ‰çš„ 2 ä¸ªæ–¹æ³•ã€‚ä¸€ä¸ªå°±æ˜¯é€šçŸ¥å˜åŒ–ï¼Œå¦ä¸€ä¸ªå°±æ˜¯è¢«æ”¶é›†èµ·æ¥åˆ° Dep ä¸­å»ã€‚</p><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span>
    <span class="token function">addDep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// æˆ‘è¿™ä¸ªWatcherè¦è¢«å¡åˆ°Depé‡Œå»äº†~~</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// Depé€šçŸ¥æˆ‘æ›´æ–°å‘¢~~</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¤§è‡´æµç¨‹" tabindex="-1"><a class="header-anchor" href="#å¤§è‡´æµç¨‹" aria-hidden="true">#</a> <strong>å¤§è‡´æµç¨‹</strong></h3><ul><li>å‘ç”Ÿåœ¨ beforeCreate å’Œ created ä¹‹é—´ initState(vm)ä¸­çš„ defineProperty</li><li>å‘ç”Ÿåœ¨ beforeMount å’Œ mounted ä¹‹é—´çš„ Dep å’Œ Watcher çš„åˆå§‹åŒ–</li><li>å‘ç”Ÿåœ¨ beforeUpdate å‰åˆ° updated è§¦å‘ï¼Œè¿™æœŸé—´ Watcher çš„ç›¸å…³å˜åŒ–</li></ul><blockquote><p>vueå°†dataåˆå§‹åŒ–ä¸ºä¸€ä¸ªObserverå¹¶å¯¹å¯¹è±¡ä¸­çš„æ¯ä¸ªå€¼ï¼Œé‡å†™äº†å…¶ä¸­çš„getã€setï¼Œdataä¸­çš„æ¯ä¸ªkeyï¼Œéƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ä¾èµ–æ”¶é›†å™¨ã€‚</p></blockquote><blockquote><p>åœ¨getä¸­ï¼Œå‘ä¾èµ–æ”¶é›†å™¨æ·»åŠ äº†ç›‘å¬ï¼Œåœ¨mountæ—¶ï¼Œå®ä¾‹äº†ä¸€ä¸ªWatcherï¼Œå°†æ”¶é›†å™¨çš„ç›®æ ‡æŒ‡å‘äº†å½“å‰Watcherã€‚</p></blockquote><blockquote><p>åœ¨dataå€¼å‘ç”Ÿå˜æ›´æ—¶ï¼Œè§¦å‘setï¼Œè§¦å‘äº†ä¾èµ–æ”¶é›†å™¨ä¸­çš„æ‰€æœ‰ç›‘å¬çš„æ›´æ–°ï¼Œæ¥è§¦å‘Watcher.update</p></blockquote>`,41),o=[p];function c(l,i){return s(),a("div",null,o)}const r=n(e,[["render",c],["__file","defineProperty.html.vue"]]);export{r as default};
